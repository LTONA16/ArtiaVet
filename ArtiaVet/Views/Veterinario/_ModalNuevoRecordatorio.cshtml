<div id="modalNuevoRecordatorio" class="hidden fixed inset-0 bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Nuevo Recordatorio</h2>
            <button onclick="cerrarModalRecordatorio()" class="text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <form id="formNuevoRecordatorio" asp-controller="Veterinario" asp-action="CrearRecordatorio" method="post">
            @Html.AntiForgeryToken()

            <input type="hidden" id="FechaRecordatorio" name="FechaRecordatorio" />

            <div class="space-y-4">

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cita *</label>
                    <select name="CitaID" id="nuevoCitaID" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Seleccione una cita</option>
                        @foreach (var cita in ViewBag.Citas)
                        {
                            <option value="@cita.Value">@cita.Text</option>
                        }
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fecha *</label>
                        <input type="date" id="fechaRecordatorioInput" required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hora *</label>
                        <input type="time" id="horaRecordatorioInput" required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Asunto *</label>
                    <input type="text" name="Asunto" maxlength="200" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Ej: Recordatorio de vacunación" />
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Mensaje *</label>
                    <textarea name="Mensaje" maxlength="500" rows="4" required
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                              placeholder="Escriba el mensaje del recordatorio..."></textarea>
                </div>
            </div>

            <div class="flex gap-3 mt-6">
                <button type="submit"
                        class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    Crear Recordatorio
                </button>
                <button type="button" onclick="cerrarModalRecordatorio()"
                        class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function abrirModalRecordatorio() {
        document.getElementById('modalNuevoRecordatorio').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function cerrarModalRecordatorio() {
        document.getElementById('modalNuevoRecordatorio').classList.add('hidden');
        document.body.style.overflow = 'auto';
        document.getElementById('formNuevoRecordatorio').reset();
    }

    // Convertimos fecha + hora → DateTime adecuado para DB
    document.getElementById('formNuevoRecordatorio').addEventListener('submit', function () {
        const fecha = document.getElementById('fechaRecordatorioInput').value;
        const hora = document.getElementById('horaRecordatorioInput').value;

        if (fecha && hora) {
            const fechaHora = `${fecha}T${hora}:00`;
            document.getElementById('FechaRecordatorio').value = fechaHora;
        }
    });

    // Cerrar modal al hacer click fuera del contenido
    document.getElementById('modalNuevoRecordatorio')?.addEventListener('click', function (e) {
        if (e.target === this) {
            cerrarModalRecordatorio();
        }
    });
</script>
