@* Modal para Nueva Cita *@
<div id="modalNuevaCita" class="hidden fixed inset-0 bg-opacity-30 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">

        @* Header del Modal *@
        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-2xl z-10">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800">Nueva Cita</h2>
                <button type="button" onclick="cerrarModalCita()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>

        @* Mensaje de Error *@
        <div id="errorMensajeCita" class="hidden mx-6 mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                </svg>
                <span id="errorTextoCita"></span>
            </div>
        </div>

        @* Formulario *@
        <form id="formNuevaCita" asp-action="CrearCitaDesdeListado" asp-controller="Recepcionista" method="post" class="p-6">
            @Html.AntiForgeryToken()

            <div class="space-y-5">

                @* Veterinario *@
                <div>
                    <label for="VeterinarioID" class="block text-sm font-semibold text-gray-700 mb-2">
                        Veterinario <span class="text-red-500">*</span>
                    </label>
                    <select id="VeterinarioID" name="VeterinarioID" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                        <option value="">Seleccione un veterinario</option>
                        @if (ViewBag.Veterinarios != null)
                        {
                            @foreach (var vet in ViewBag.Veterinarios as List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)
                            {
                                <option value="@vet.Value">@vet.Text</option>
                            }
                        }
                    </select>
                </div>

                @* Mascota *@
                <div>
                    <label for="MascotaID" class="block text-sm font-semibold text-gray-700 mb-2">
                        Mascota <span class="text-red-500">*</span>
                    </label>
                    <div class="flex gap-2">
                        <select id="MascotaID" name="MascotaID" required
                                class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                            <option value="">Seleccione una mascota</option>
                            @if (ViewBag.Mascotas != null)
                            {
                                @foreach (var mascota in ViewBag.Mascotas as List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)
                                {
                                    <option value="@mascota.Value">@mascota.Text</option>
                                }
                            }
                        </select>
                        <button type="button" onclick="abrirModalMascota()" 
                                class="px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            <span class="text-gray-600 text-lg leading-none">+</span>
                        </button>
                    </div>
                </div>

                @* Tipo de Cita *@
                <div>
                    <label for="TipoCitaID" class="block text-sm font-semibold text-gray-700 mb-2">
                        Tipo de Cita <span class="text-red-500">*</span>
                    </label>
                    <select id="TipoCitaID" name="TipoCitaID" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                        <option value="">Seleccione un tipo de cita</option>
                        @if (ViewBag.TiposCita != null)
                        {
                            @foreach (var tipo in ViewBag.TiposCita as List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)
                            {
                                <option value="@tipo.Value">@tipo.Text</option>
                            }
                        }
                    </select>
                </div>

                @* Fecha y Hora de la Cita *@
                <input type="hidden" id="FechaCita" name="FechaCita" />

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="fechaCitaInput" class="block text-sm font-semibold text-gray-700 mb-2">
                            Fecha <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="fechaCitaInput" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" />
                    </div>
                    <div>
                        <label for="horaCitaInput" class="block text-sm font-semibold text-gray-700 mb-2">
                            Hora <span class="text-red-500">*</span>
                        </label>
                        <input type="time" id="horaCitaInput" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all" />
                    </div>
                </div>

                @* Importe Adicional *@
                <div>
                    <label for="ImporteAdicional" class="block text-sm font-semibold text-gray-700 mb-2">
                        Importe Adicional
                    </label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">$</span>
                        <input type="number" id="ImporteAdicional" name="ImporteAdicional" step="0.01" min="0" value="0"
                               class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"
                               placeholder="0.00" />
                    </div>
                </div>

                @* Observaciones *@
                <div>
                    <label for="Observaciones" class="block text-sm font-semibold text-gray-700 mb-2">
                        Observaciones
                    </label>
                    <textarea id="Observaciones" name="Observaciones" rows="4"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all resize-none"
                              placeholder="Escriba cualquier observación adicional sobre la cita..."></textarea>
                </div>

            </div>

            @* Botones *@
            <div class="flex gap-3 mt-6 pt-6 border-t border-gray-200">
                <button type="button" onclick="cerrarModalCita()"
                        class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                    Cancelar
                </button>
                <button type="submit"
                        class="flex-1 px-6 py-3 bg-cyan-600 text-white font-medium rounded-lg hover:bg-cyan-700 transition-colors">
                    Guardar Cita
                </button>
            </div>
        </form>

    </div>
</div>

// Reemplaza el script existente en _ModalNuevaCita.cshtml con este:

<script>
    function abrirModalCita() {
        document.getElementById('modalNuevaCita').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        ocultarErrorCita();
    }

    function cerrarModalCita() {
        document.getElementById('modalNuevaCita').classList.add('hidden');
        document.body.style.overflow = 'auto';
        document.getElementById('formNuevaCita').reset();
        ocultarErrorCita();
    }

    function mostrarErrorCita(mensaje) {
        const errorDiv = document.getElementById('errorMensajeCita');
        const errorTexto = document.getElementById('errorTextoCita');
        errorTexto.textContent = mensaje;
        errorDiv.classList.remove('hidden');
        errorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function ocultarErrorCita() {
        document.getElementById('errorMensajeCita').classList.add('hidden');
    }

    // ESTE ES EL FIX PRINCIPAL
    document.getElementById('formNuevaCita').addEventListener('submit', function (e) {
        const fechaInput = document.getElementById('fechaCitaInput').value;
        const horaInput = document.getElementById('horaCitaInput').value;

        console.log('Fecha input:', fechaInput);
        console.log('Hora input:', horaInput);

        if (!fechaInput || !horaInput) {
            e.preventDefault();
            mostrarErrorCita('Por favor seleccione fecha y hora de la cita');
            return false;
        }

        // Combinar fecha y hora en formato ISO 8601
        const fechaHoraISO = `${fechaInput}T${horaInput}:00`;
        console.log('Fecha y hora combinada (ISO):', fechaHoraISO);
        
        // Asignar al campo oculto
        document.getElementById('FechaCita').value = fechaHoraISO;
        
        console.log('Valor final en FechaCita:', document.getElementById('FechaCita').value);
        
        // Permitir que el formulario se envíe
        return true;
    });

    document.getElementById('modalNuevaCita')?.addEventListener('click', function (e) {
        if (e.target === this) {
            cerrarModalCita();
        }
    });
</script>